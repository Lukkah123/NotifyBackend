# NotifyBackend
Github repository for the Notify project backend. Built using Spring boot.
## REST-Api Documentation

---
![Image of REST-Api documentation](images/Notify_Rest-Api_Documentation.png)

### _User object example in JSON for POST & PUT:_
```json
{  
  "email" : "dummyemail@gmail.com",  
  "password" : "dummypassword"  
}
```
### _User object example in JSON for GET:_
```json
{  
  "email" : "dummyemail@gmail.com",  
  "password" : "dummypassword",
  "notes": []
}
```
The notes belonging to the fetched user is returned as a part of the user object in an array called notes.
### _Note object example in JSON:_
```json 
{
  "title": "dummyNote",  
  "body": "This is some body text for the note",  
  "created": "2022-04-14T13:34:00",   
}
```
The note has PK called id that is autogenerated and thus not required.
### _Cookie object example in JSON:_
```json 
{
    "name": "userId",
    "value": "dummy@gmail.com",
    "version": 0,
    "comment": null,
    "domain": "localhost",
    "maxAge": -1,
    "path": "/",
    "secure": false,
    "httpOnly": true
}
```

## How to run the backend locally with PostgreSql:
### Step 1.

---
[Download and install PostgreSql.](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads) Make sure to remember the details used during the installation process.  
This information will  be used later to connect your database to the Spring boot application. You can check   
your current PostgreSql version by typing "psql --version" in the command line.
### Step 2.

---
Open "SQL shell" on you computer. Press enter four times for server, database, port and username. Enter  
your chosen password during the installation if required. Once logged in create a local database using:
```postgresql
CREATE DATABASE nameOfYourDatabase;
```
![Image of SQL Shell](images/SQLShellImage.png)

### Step 3.

---
Clone this project using the link: https://github.com/Lukkah123/NotifyBackend.git  
The project already contains the required PostgreSql dependency:
```xml
<dependency>
    <groupId>org.postgresql</groupId>
    <artifactId>postgresql</artifactId>
    <scope>runtime</scope>
</dependency>
```
### Step 4.

---
Add the following to the application.properties file to connect the Spring boot application to your database:
```properties
spring.datasource.url=jdbc:postgresql://localhost:5555/notifybackendtesting
spring.datasource.username=postgres
spring.datasource.password=mySecretPassword
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
```
NOTE:  
Replace the number 5555 with the port your PostgreSql database is running on and myDatabase with  
the name of your local database that you created in step 2. Enter the password and username  
chosen during the installation.

The application is now connected to your local PostgreSql database.

### Step 5. (Optional)

---
If you want to view the contents of the PostgreSql database directly this can be accomplished using the   
SQL shell. Type "\l" to list all your databases.  
![Image of SQL Shell listing all databases](images/SQLShellListOfDatabases.png)

Type "\c databaseName" to connect to a particular database in the list. Once connected queries can be  
sent to the database. In this example we only want to view the data in the database. First we can obtain  
all tables in the database using the "\dt" command. Lastly we fetch all rows using a SELECT query.  
Note that all passwords are encrypted in the database. Furthermore, if the applications hasn't been run  
the database will be empty. Hibernate automatically creates tables from the specified @Entities.

![Image of SQL Shell connecting to database and fetching table data](images/SQLShellAllUsers.png)

## How the database credentials are encrypted using Jasypt:
To encrypt a value using jasypt use the following command in the terminal:  
```java
mvn jasypt:encrypt-value -Djasypt.encryptor.password=IAmTheSecretKey -Djasypt.plugin.value=IAmAValueToEncrypt
```
The picture below shows the result printed in the terminal. The now encrypted inputted string is highlighted within  
the parenthesen after ENC:  

bf38JAJXEkVaD5UrewyZpMVQE3xM7SPhemaXIhUEIuiSReP6EBRLiR2lDopT1MGVL12uIybYD8wz9Mg1AQxYRQ==

![Result of Jasypt encryption](images/JasyptEncryption.png)

To decypt the the encrypted value using jasypt use the following command in the terminal:
```java
mvn jasypt:decrypt-value -Djasypt.encryptor.password=IAmTheSecretKey -Djasypt.plugin.value=bf38JAJXEkVaD5UrewyZpMVQE3xM7SPhemaXIhUEIuiSReP6EBRLiR2lDopT1MGVL12uIybYD8wz9Mg1AQxYRQ==
```
The picture below now shows the original value after decrypting the inputted encrypted value.

![Result of Jasypt decryption](images/JasyptDecryption.png)

Knowing that the encryption and decryption works the spring.datasource.username & spring.datasource password  
in application.properties can be encrypted and replaced with the encrypted string shown in the picture ENC(...).  
The last step is to add the secret key to the VM options to decrypt the values at runtime:

![VM option for Jasypt runtime decryption](images/VMConfiguration.png)
### _Authors:_

---
Simon Sand√©n | Henrik Lukka | Hugo Sigurdson | Mohammadreza Kazemi
